"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"checkStatus",value:function(e){return 200===e.status?Promise.resolve(e):Promise.reject(new Error("Request has failed. Return status: "+e.statusText))}},{key:"json",value:function(e){return e.json()}},{key:"openDB",value:function(){return idb.open("restaurantsDB",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("by-id","id")})}},{key:"getRestaurantsFromDB",value:function(){return n.openDB().then(function(e){if(console.log("Getting Restaurants From DB"),e)return e.transaction("restaurants").objectStore("restaurants").getAll()})}},{key:"getRestaurantsFromAPI",value:function(){return console.log("Getting Restaurants From API"),fetch(n.DATABASE_URL).then(n.checkStatus).then(n.json).then(function(e){return n.saveRestaurants(e),e})}},{key:"saveRestaurants",value:function(r){return n.openDB().then(function(e){if(e){var t=e.transaction("restaurants","readwrite"),n=t.objectStore("restaurants");return r.forEach(function(e){n.put(e)}),t.complete}}).then(function(){console.log("Restaurants Saved")})}},{key:"fetchRestaurants",value:function(t){return n.getRestaurantsFromDB().then(function(e){return e.length?Promise.resolve(e):n.getRestaurantsFromAPI()}).then(function(e){t(null,e)}).catch(function(e){t(e,null)})}},{key:"fetchRestaurantById",value:function(r,u){n.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.find(function(e){return e.id==r});n?u(null,n):u("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,u){n.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});u(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,u){n.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});u(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,u,a){n.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=u&&(n=n.filter(function(e){return e.neighborhood==u})),a(null,n)}})}},{key:"fetchNeighborhoods",value:function(u){n.fetchRestaurants(function(e,n){if(e)u(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});u(null,t)}})}},{key:"fetchCuisines",value:function(u){n.fetchRestaurants(function(e,n){if(e)u(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});u(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==t?"/build/img/"+e.id+"-"+t+".jpg":"/build/img/"+e.id+"-original.jpg"}},{key:"imageSrcSetForRestaurant",value:function(e){return n.imageUrlForRestaurant(e,"xsmall")+" 360w, "+n.imageUrlForRestaurant(e,"small")+" 520w, "+n.imageUrlForRestaurant(e,"medium")+" 800w, "+n.imageUrlForRestaurant(e,"large")+" 1000w, "+n.imageUrlForRestaurant(e)+" 1500w"}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:n.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),n}();
//# sourceMappingURL=dbhelper.js.map
